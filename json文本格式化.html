<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON 解析编辑器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }
        .editor-container {
            display: flex;
            gap: 20px;
        }
        .editor-box {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .editor-wrapper {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        #monaco-editor {
            width: 100%;
            height: 100%;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .error {
            color: #f44336;
            margin-top: 10px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
            display: none;
        }
        .tree-view {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: white;
            height: 400px;
            overflow: auto;
        }
        .status-bar {
            padding: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }
        .valid {
            color: #4CAF50;
        }
        .invalid {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSON 解析编辑器</h1>
        
        <div class="controls">
            <button id="format-btn">格式化</button>
            <button id="minify-btn">压缩</button>
            <button id="clear-btn">清空</button>
            <button id="example-btn">示例</button>
            <button id="validate-btn">验证</button>
        </div>
        
        <div class="editor-container">
            <div class="editor-box">
                <h3>JSON 输入</h3>
                <div class="editor-wrapper">
                    <div id="monaco-editor"></div>
                </div>
                <div id="error-message" class="error"></div>
            </div>
            
            <div class="editor-box">
                <h3>格式化视图</h3>
                <div id="tree-view" class="tree-view"></div>
            </div>
        </div>
        
        <div class="status-bar">
            JSON 状态: <span id="status-text">等待输入...</span>
        </div>
    </div>

    <!-- 加载 Monaco Editor 资源 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 配置 Monaco Editor
            require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
            
            let editor;
            
            require(['vs/editor/editor.main'], function() {
                // 创建编辑器实例
                editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                    value: '',
                    language: 'json',
                    theme: 'vs',
                    automaticLayout: true,
                    minimap: { enabled: false },
                    scrollBeyondLastLine: false,
                    fontSize: 14,
                    lineHeight: 20,
                    lineNumbers: 'on',
                    roundedSelection: true,
                    scrollbar: {
                        vertical: 'auto',
                        horizontal: 'auto'
                    }
                });
                
                // 初始化编辑器内容
                editor.setValue('');
                
                // 按钮事件监听
                document.getElementById('format-btn').addEventListener('click', formatJson);
                document.getElementById('minify-btn').addEventListener('click', minifyJson);
                document.getElementById('clear-btn').addEventListener('click', clearEditor);
                document.getElementById('example-btn').addEventListener('click', loadExample);
                document.getElementById('validate-btn').addEventListener('click', validateJson);
            });
            
            const treeView = document.getElementById('tree-view');
            const errorMessage = document.getElementById('error-message');
            const statusText = document.getElementById('status-text');
            
            // 获取编辑器内容
            function getEditorValue() {
                return editor ? editor.getValue() : '';
            }
            
            // 设置编辑器内容
            function setEditorValue(value) {
                if (editor) {
                    editor.setValue(value);
                }
            }
            
            // 格式化 JSON
            function formatJson() {
                try {
                    const jsonObj = JSON.parse(getEditorValue());
                    setEditorValue(JSON.stringify(jsonObj, null, 2));
                    renderTreeView(jsonObj);
                    showStatus('JSON 格式正确', true);
                    hideError();
                } catch (e) {
                    showError(e.message);
                    showStatus('JSON 格式错误', false);
                }
            }
            
            // 压缩 JSON
            function minifyJson() {
                try {
                    const jsonObj = JSON.parse(getEditorValue());
                    setEditorValue(JSON.stringify(jsonObj));
                    renderTreeView(jsonObj);
                    showStatus('JSON 格式正确', true);
                    hideError();
                } catch (e) {
                    showError(e.message);
                    showStatus('JSON 格式错误', false);
                }
            }
            
            // 清空编辑器
            function clearEditor() {
                setEditorValue('');
                treeView.innerHTML = '';
                hideError();
                showStatus('编辑器已清空', true);
            }
            
            // 加载示例
            function loadExample() {
                const exampleJson = {
                    "name": "JSON 编辑器示例",
                    "version": "1.0.0",
                    "description": "这是一个 JSON 编辑器的示例数据",
                    "features": [
                        "格式化",
                        "压缩",
                        "验证",
                        "语法高亮",
                        "行号显示"
                    ],
                    "metadata": {
                        "created": "2023-05-20",
                        "author": "AI助手",
                        "license": "MIT"
                    },
                    "active": true,
                    "count": 42
                };
                
                setEditorValue(JSON.stringify(exampleJson, null, 2));
                renderTreeView(exampleJson);
            }
            
            // 验证 JSON
            function validateJson() {
                try {
                    const jsonObj = JSON.parse(getEditorValue());
                    renderTreeView(jsonObj);
                    showStatus('JSON 格式正确', true);
                    hideError();
                    return true;
                } catch (e) {
                    showError(e.message);
                    showStatus('JSON 格式错误', false);
                    return false;
                }
            }
            
            // 显示错误信息
            function showError(message) {
                errorMessage.textContent = `错误: ${message}`;
                errorMessage.style.display = 'block';
            }
            
            // 隐藏错误信息
            function hideError() {
                errorMessage.style.display = 'none';
            }
            
            // 显示状态信息
            function showStatus(message, isValid) {
                statusText.textContent = message;
                statusText.className = isValid ? 'valid' : 'invalid';
            }
            
            // 渲染树形视图
            function renderTreeView(jsonObj) {
                treeView.innerHTML = '';
                treeView.appendChild(createTreeElement(jsonObj));
            }
            
            // 创建树形元素
            function createTreeElement(data, depth = 0) {
                const element = document.createElement('div');
                element.style.marginLeft = `${depth * 15}px`;
                
                if (data === null) {
                    const nullElement = document.createElement('span');
                    nullElement.textContent = 'null';
                    nullElement.style.color = '#7f00ff';
                    element.appendChild(nullElement);
                } else if (typeof data === 'object') {
                    if (Array.isArray(data)) {
                        const arrayIndicator = document.createElement('span');
                        arrayIndicator.textContent = '[';
                        arrayIndicator.style.color = '#0077aa';
                        element.appendChild(arrayIndicator);
                        
                        if (data.length === 0) {
                            const emptyIndicator = document.createElement('span');
                            emptyIndicator.textContent = '] (空数组)';
                            emptyIndicator.style.color = '#0077aa';
                            element.appendChild(emptyIndicator);
                        } else {
                            const toggleButton = document.createElement('button');
                            toggleButton.textContent = '...] (' + data.length + ' 项)';
                            toggleButton.style.marginLeft = '5px';
                            toggleButton.style.background = 'none';
                            toggleButton.style.border = 'none';
                            toggleButton.style.color = '#0077aa';
                            toggleButton.style.cursor = 'pointer';
                            toggleButton.style.padding = '0';
                            
                            const itemsContainer = document.createElement('div');
                            itemsContainer.style.display = 'none';
                            
                            data.forEach((item, index) => {
                                const itemElement = createTreeElement(item, depth + 1);
                                const indexElement = document.createElement('span');
                                indexElement.textContent = `${index}: `;
                                indexElement.style.color = '#888';
                                itemsContainer.appendChild(indexElement);
                                itemsContainer.appendChild(itemElement);
                            });
                            
                            toggleButton.addEventListener('click', function() {
                                if (itemsContainer.style.display === 'none') {
                                    itemsContainer.style.display = 'block';
                                    toggleButton.textContent = '收起]';
                                } else {
                                    itemsContainer.style.display = 'none';
                                    toggleButton.textContent = '...] (' + data.length + ' 项)';
                                }
                            });
                            
                            element.appendChild(toggleButton);
                            element.appendChild(itemsContainer);
                        }
                    } else {
                        const objectIndicator = document.createElement('span');
                        objectIndicator.textContent = '{';
                        objectIndicator.style.color = '#0077aa';
                        element.appendChild(objectIndicator);
                        
                        const keys = Object.keys(data);
                        if (keys.length === 0) {
                            const emptyIndicator = document.createElement('span');
                            emptyIndicator.textContent = '} (空对象)';
                            emptyIndicator.style.color = '#0077aa';
                            element.appendChild(emptyIndicator);
                        } else {
                            const toggleButton = document.createElement('button');
                            toggleButton.textContent = '...} (' + keys.length + ' 属性)';
                            toggleButton.style.marginLeft = '5px';
                            toggleButton.style.background = 'none';
                            toggleButton.style.border = 'none';
                            toggleButton.style.color = '#0077aa';
                            toggleButton.style.cursor = 'pointer';
                            toggleButton.style.padding = '0';
                            
                            const propertiesContainer = document.createElement('div');
                            propertiesContainer.style.display = 'none';
                            
                            keys.forEach(key => {
                                const propertyElement = document.createElement('div');
                                propertyElement.style.marginLeft = '15px';
                                
                                const keyElement = document.createElement('span');
                                keyElement.textContent = `"${key}": `;
                                keyElement.style.color = '#aa5500';
                                
                                const valueElement = createTreeElement(data[key], depth + 1);
                                
                                propertyElement.appendChild(keyElement);
                                propertyElement.appendChild(valueElement);
                                propertiesContainer.appendChild(propertyElement);
                            });
                            
                            toggleButton.addEventListener('click', function() {
                                if (propertiesContainer.style.display === 'none') {
                                    propertiesContainer.style.display = 'block';
                                    toggleButton.textContent = '收起}';
                                } else {
                                    propertiesContainer.style.display = 'none';
                                    toggleButton.textContent = '...} (' + keys.length + ' 属性)';
                                }
                            });
                            
                            element.appendChild(toggleButton);
                            element.appendChild(propertiesContainer);
                        }
                    }
                } else {
                    const valueElement = document.createElement('span');
                    if (typeof data === 'string') {
                        valueElement.textContent = `"${data}"`;
                        valueElement.style.color = '#aa0000';
                    } else if (typeof data === 'number') {
                        valueElement.textContent = data;
                        valueElement.style.color = '#00aa00';
                    } else if (typeof data === 'boolean') {
                        valueElement.textContent = data ? 'true' : 'false';
                        valueElement.style.color = '#7f00ff';
                    }
                    element.appendChild(valueElement);
                }
                
                return element;
            }
            
            // 初始化状态
            showStatus('等待输入...', true);
        });
    </script>
</body>
</html>